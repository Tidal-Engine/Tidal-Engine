<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vulkan Infrastructure - Tidal Engine Documentation</title>
    <link rel="stylesheet" href="../assets/styles.css">
</head>
<body>
    <div class="container">
        <!-- Left Sidebar Navigation -->
        <nav class="sidebar-left">
            <h1>Tidal Engine</h1>

            <div class="nav-section">
                <h3>Getting Started</h3>
                <ul>
                    <li><a href="../index.html">Overview</a></li>
                    <li><a href="../development/architecture.html">Architecture</a></li>
                    <li><a href="../getting-started/quick-start.html">Quick Start</a></li>
                </ul>
            </div>

            <div class="nav-section">
                <h3>Core Systems</h3>
                <ul>
                    <li><a href="rendering.html">Rendering System</a></li>
                    <li><a href="networking.html">Networking</a></li>
                    <li><a href="world-system.html">World System</a></li>
                    <li><a href="input-system.html">Input System</a></li>
                </ul>
            </div>

            <div class="nav-section">
                <h3>Infrastructure</h3>
                <ul>
                    <li><a href="vulkan-infrastructure.html" class="active">Vulkan Infrastructure</a></li>
                    <li><a href="threading.html">Threading & Concurrency</a></li>
                    <li><a href="shaders.html">Shader System</a></li>
                </ul>
            </div>

            <div class="nav-section">
                <h3>Development</h3>
                <ul>
                    <li><a href="../getting-started/build-system.html">Build System</a></li>
                    <li><a href="../development/performance.html">Performance</a></li>
                    <li><a href="../development/debugging.html">Debugging</a></li>
                </ul>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="content">
            <section class="section">
                <h1>Vulkan Infrastructure</h1>

                <h2>VulkanDevice</h2>
                <p class="file-path">include/VulkanDevice.h</p>
                <div class="info-box">
                    RAII wrapper for Vulkan device management with automatic resource cleanup.
                </div>

                <div class="method-signature">
                    <code>std::unique_ptr&lt;VulkanDevice&gt; VulkanDevice::create(VkInstance instance, VkSurfaceKHR surface)</code><br>
                    Factory method that selects optimal GPU and creates logical device with required extensions.
                </div>

                <pre><code>// Required device extensions
std::vector&lt;const char*&gt; deviceExtensions = {
    VK_KHR_SWAPCHAIN_EXTENSION_NAME,
    VK_KHR_MAINTENANCE1_EXTENSION_NAME  // For negative viewport height
};

// Queue family requirements
struct QueueFamilyIndices {
    std::optional&lt;uint32_t&gt; graphicsFamily;
    std::optional&lt;uint32_t&gt; presentFamily;
    std::optional&lt;uint32_t&gt; transferFamily;  // Dedicated transfer queue
};</code></pre>

                <h2>Buffer Management</h2>
                <div class="method-signature">
                    <code>class VulkanBuffer</code><br>
                    RAII buffer wrapper with automatic memory management and staging buffer support.
                </div>

                <pre><code>// Buffer creation patterns
// Vertex buffer (device local)
auto vertexBuffer = VulkanBuffer::create(
    device, vertices.size() * sizeof(Vertex),
    VK_BUFFER_USAGE_VERTEX_BUFFER_BIT | VK_BUFFER_USAGE_TRANSFER_DST_BIT,
    VK_MEMORY_PROPERTY_DEVICE_LOCAL_BIT
);

// Staging buffer (host visible)
auto stagingBuffer = VulkanBuffer::create(
    device, dataSize,
    VK_BUFFER_USAGE_TRANSFER_SRC_BIT,
    VK_MEMORY_PROPERTY_HOST_VISIBLE_BIT | VK_MEMORY_PROPERTY_HOST_COHERENT_BIT
);</code></pre>

                <h2>Memory Management</h2>
                <div class="info-box">
                    The engine uses Vulkan Memory Allocator (VMA) patterns for efficient GPU memory management with automatic defragmentation.
                </div>

                <pre><code>// Memory allocation strategy
1. Device local memory for GPU-only resources (vertex/index buffers)
2. Host visible memory for CPU-GPU data transfer (staging buffers)
3. Host cached memory for read-back operations
4. Automatic memory type selection based on usage patterns</code></pre>
            </section>
        </main>

        <!-- Right Sidebar - Table of Contents -->
        <aside class="sidebar-right">
            <div class="toc">
                <h4>On This Page</h4>
                <ul>
                    <!-- TOC will be dynamically generated -->
                </ul>
            </div>
        </aside>
    </div>

    <script src="../assets/nav.js"></script>
</body>
</html>